<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action RPG - デフォルト背景版</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #1a1a2e;
            font-family: 'Arial', sans-serif;
        }
        
        .game-container {
            text-align: center;
            background-color: #16213e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }
        
        canvas {
            border: 3px solid #0f4c75;
            background-color: #0f3460;
            cursor: crosshair;
            /* 背景画像の設定 */
            background-image: url('https://picsum.photos/800/600');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .bg-controls {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #0f3460;
            border-radius: 5px;
            color: #ecf0f1;
        }
        
        .bg-controls button {
            margin: 0 5px;
            padding: 5px 10px;
            background-color: #e94560;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .bg-controls button:hover {
            background-color: #d63652;
        }
        
        .info {
            color: #ecf0f1;
            margin-top: 15px;
        }
        
        .controls {
            margin-top: 10px;
            color: #bdc3c7;
            font-size: 14px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            color: #ecf0f1;
        }
        
        h1 {
            color: #e94560;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Action RPG - 背景画像デモ</h1>
        
        <div class="bg-controls">
            <span>背景画像サンプル:</span>
            <button onclick="changeBackground(1)">風景</button>
            <button onclick="changeBackground(2)">都市</button>
            <button onclick="changeBackground(3)">自然</button>
            <button onclick="changeBackground(4)">抽象</button>
            <button onclick="changeBackground(0)">なし</button>
            <label style="margin-left: 20px;">
                透明度: <input type="range" id="opacitySlider" min="0" max="100" value="30" style="width: 100px;">
                <span id="opacityValue">30%</span>
            </label>
        </div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="info">
            <div class="controls">
                移動: 矢印キー/WASD | 攻撃: スペース | 特殊攻撃: E
            </div>
            <div class="stats">
                <span>座標: <span id="position" style="color: #f39c12; font-weight: bold;">X:400 Y:300</span></span>
                <span>HP: <span id="hp">100/100</span></span>
                <span>MP: <span id="mp">50/50</span></span>
                <span>レベル: <span id="level">1</span></span>
                <span>スコア: <span id="score">0</span></span>
            </div>
        </div>
    </div>

    <script>
        console.log('[ACTION RPG] 背景画像デモ版 - ゲーム初期化開始');
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // 背景画像の切り替え
        function changeBackground(type) {
            switch(type) {
                case 0:
                    canvas.style.backgroundImage = 'none';
                    canvas.style.backgroundColor = '#0f3460';
                    break;
                case 1:
                    canvas.style.backgroundImage = 'url(https://picsum.photos/800/600?random=1)';
                    break;
                case 2:
                    canvas.style.backgroundImage = 'url(https://picsum.photos/800/600?random=2)';
                    break;
                case 3:
                    canvas.style.backgroundImage = 'url(https://picsum.photos/800/600?random=3)';
                    break;
                case 4:
                    canvas.style.backgroundImage = 'url(https://picsum.photos/800/600?random=4)';
                    break;
            }
        }
        
        // 透明度調整
        document.getElementById('opacitySlider').addEventListener('input', function(e) {
            const opacity = e.target.value / 100;
            document.getElementById('opacityValue').textContent = e.target.value + '%';
            
            // Canvas自体の透明度ではなく、描画内容の透明度を調整
            ctx.globalAlpha = 1;
            
            // 背景の明度を調整するためのオーバーレイ
            game.bgOverlayOpacity = 1 - opacity;
        });
        
        // ゲーム状態
        const game = {
            player: {
                x: 400,
                y: 300,
                width: 32,
                height: 32,
                speed: 5,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                level: 1,
                score: 0,
                color: '#e94560',
                facing: 'right',
                attackCooldown: 0
            },
            enemies: [],
            projectiles: [],
            particles: [],
            keys: {},
            frameCount: 0,
            bgOverlayOpacity: 0.7
        };
        
        // 弾クラス
        class Projectile {
            constructor(x, y, dx, dy) {
                this.x = x;
                this.y = y;
                this.dx = dx;
                this.dy = dy;
                this.size = 8;
                this.color = '#f39c12';
                this.lifetime = 60;
            }
            
            update() {
                this.x += this.dx;
                this.y += this.dy;
                this.lifetime--;
                
                // パーティクル
                if (game.frameCount % 3 === 0) {
                    game.particles.push({
                        x: this.x,
                        y: this.y,
                        dx: (Math.random() - 0.5) * 2,
                        dy: (Math.random() - 0.5) * 2,
                        size: 4,
                        color: this.color,
                        lifetime: 10
                    });
                }
                
                return this.lifetime > 0 && 
                       this.x > 0 && this.x < canvas.width &&
                       this.y > 0 && this.y < canvas.height;
            }
            
            draw() {
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }
        
        // 敵生成
        function spawnEnemy() {
            const edge = Math.floor(Math.random() * 4);
            let x, y;
            
            switch(edge) {
                case 0: x = Math.random() * canvas.width; y = -30; break;
                case 1: x = canvas.width + 30; y = Math.random() * canvas.height; break;
                case 2: x = Math.random() * canvas.width; y = canvas.height + 30; break;
                case 3: x = -30; y = Math.random() * canvas.height; break;
            }
            
            const enemy = {
                x: x,
                y: y,
                width: 32,
                height: 32,
                hp: 30,
                speed: 1 + Math.random() * 2,
                color: '#e74c3c'
            };
            
            game.enemies.push(enemy);
        }
        
        // 攻撃
        function playerAttack() {
            if (game.player.attackCooldown > 0) return;
            
            game.player.attackCooldown = 15;
            const speed = 10;
            
            let dx = 0, dy = 0;
            switch(game.player.facing) {
                case 'up': dy = -speed; break;
                case 'down': dy = speed; break;
                case 'left': dx = -speed; break;
                case 'right': dx = speed; break;
            }
            
            game.projectiles.push(new Projectile(
                game.player.x + game.player.width / 2,
                game.player.y + game.player.height / 2,
                dx, dy
            ));
        }
        
        // 特殊攻撃
        function specialAttack() {
            if (game.player.mp < 20) return;
            
            game.player.mp -= 20;
            
            // 8方向に弾を発射
            for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 4) {
                const speed = 8;
                game.projectiles.push(new Projectile(
                    game.player.x + game.player.width / 2,
                    game.player.y + game.player.height / 2,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed
                ));
            }
        }
        
        // キー入力
        document.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;
            
            if (e.key === ' ') {
                e.preventDefault();
                playerAttack();
            }
            if (e.key === 'e' || e.key === 'E') {
                e.preventDefault();
                specialAttack();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });
        
        // アップデート
        function update() {
            // プレイヤー移動
            const speed = game.player.speed;
            
            if (game.keys['ArrowLeft'] || game.keys['a'] || game.keys['A']) {
                game.player.x = Math.max(0, game.player.x - speed);
                game.player.facing = 'left';
            }
            if (game.keys['ArrowRight'] || game.keys['d'] || game.keys['D']) {
                game.player.x = Math.min(canvas.width - game.player.width, game.player.x + speed);
                game.player.facing = 'right';
            }
            if (game.keys['ArrowUp'] || game.keys['w'] || game.keys['W']) {
                game.player.y = Math.max(0, game.player.y - speed);
                game.player.facing = 'up';
            }
            if (game.keys['ArrowDown'] || game.keys['s'] || game.keys['S']) {
                game.player.y = Math.min(canvas.height - game.player.height, game.player.y + speed);
                game.player.facing = 'down';
            }
            
            // クールダウン
            if (game.player.attackCooldown > 0) game.player.attackCooldown--;
            
            // MP回復
            if (game.frameCount % 30 === 0 && game.player.mp < game.player.maxMp) {
                game.player.mp++;
            }
            
            // 弾の更新
            game.projectiles = game.projectiles.filter(proj => {
                if (!proj.update()) return false;
                
                // 敵との衝突
                for (let i = game.enemies.length - 1; i >= 0; i--) {
                    const enemy = game.enemies[i];
                    if (Math.abs(proj.x - (enemy.x + enemy.width/2)) < enemy.width/2 &&
                        Math.abs(proj.y - (enemy.y + enemy.height/2)) < enemy.height/2) {
                        enemy.hp -= 10;
                        
                        // ヒットエフェクト
                        for (let j = 0; j < 8; j++) {
                            game.particles.push({
                                x: proj.x,
                                y: proj.y,
                                dx: (Math.random() - 0.5) * 8,
                                dy: (Math.random() - 0.5) * 8,
                                size: 6,
                                color: enemy.color,
                                lifetime: 15
                            });
                        }
                        
                        if (enemy.hp <= 0) {
                            game.enemies.splice(i, 1);
                            game.player.score += 10;
                        }
                        
                        return false;
                    }
                }
                
                return true;
            });
            
            // 敵の移動
            game.enemies.forEach(enemy => {
                const dx = game.player.x - enemy.x;
                const dy = game.player.y - enemy.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 0) {
                    enemy.x += (dx / dist) * enemy.speed;
                    enemy.y += (dy / dist) * enemy.speed;
                }
                
                // プレイヤーとの衝突
                if (Math.abs(enemy.x - game.player.x) < 32 &&
                    Math.abs(enemy.y - game.player.y) < 32) {
                    game.player.hp = Math.max(0, game.player.hp - 1);
                }
            });
            
            // パーティクル更新
            game.particles = game.particles.filter(p => {
                p.x += p.dx;
                p.y += p.dy;
                p.lifetime--;
                p.size *= 0.95;
                return p.lifetime > 0;
            });
            
            // 敵スポーン
            if (game.frameCount % 120 === 0) {
                spawnEnemy();
            }
            
            // UI更新
            updateUI();
            
            game.frameCount++;
        }
        
        // UI更新
        function updateUI() {
            document.getElementById('position').textContent = `X:${Math.round(game.player.x)} Y:${Math.round(game.player.y)}`;
            document.getElementById('hp').textContent = `${game.player.hp}/${game.player.maxHp}`;
            document.getElementById('mp').textContent = `${game.player.mp}/${game.player.maxMp}`;
            document.getElementById('level').textContent = game.player.level;
            document.getElementById('score').textContent = game.player.score;
        }
        
        // 描画
        function render() {
            // クリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 半透明の暗いオーバーレイ（背景を見やすくするため）
            ctx.fillStyle = `rgba(15, 52, 96, ${game.bgOverlayOpacity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // パーティクル
            game.particles.forEach(p => {
                ctx.globalAlpha = p.lifetime / 15;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
            });
            ctx.globalAlpha = 1;
            
            // 弾
            game.projectiles.forEach(proj => proj.draw());
            
            // 敵
            game.enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // 輪郭
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });
            
            // プレイヤー
            ctx.fillStyle = game.player.color;
            ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
            
            // プレイヤーの向き
            ctx.fillStyle = '#fff';
            switch(game.player.facing) {
                case 'up': 
                    ctx.fillRect(game.player.x + game.player.width/2 - 2, game.player.y, 4, 8);
                    break;
                case 'down':
                    ctx.fillRect(game.player.x + game.player.width/2 - 2, game.player.y + game.player.height - 8, 4, 8);
                    break;
                case 'left':
                    ctx.fillRect(game.player.x, game.player.y + game.player.height/2 - 2, 8, 4);
                    break;
                case 'right':
                    ctx.fillRect(game.player.x + game.player.width - 8, game.player.y + game.player.height/2 - 2, 8, 4);
                    break;
            }
            
            // プレイヤーの輪郭
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(game.player.x, game.player.y, game.player.width, game.player.height);
        }
        
        // ゲームループ
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
        
        // 初期化
        console.log('[ACTION RPG] ゲーム開始 - 背景画像をボタンで切り替えできます');
        
        // 初期敵配置
        for (let i = 0; i < 3; i++) {
            setTimeout(() => spawnEnemy(), i * 1000);
        }
        
        gameLoop();
    </script>
</body>
</html>